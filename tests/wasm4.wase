include lib/wasm4;

import memory 1 = env.memory;

data square = 0 offset 0xa0b0;

data moveText = "Move the square!" offset 0x25a0;

x : mutable i32 = 76;
y : mutable i32 = 76;

handleInput() -> () {
	gamepad : i32 = load<>(GAMEPAD1);
	var dx : i32 = 0;
	var dy : i32 = 0;

	if (gamepad & BUTTON_LEFT) {
		dx := -1;
	};
	if (gamepad & BUTTON_RIGHT) {
		dx := 1;
	};
	if (gamepad & BUTTON_UP) {
		dy := -1;
	};
	if (gamepad & BUTTON_DOWN) {
		dy := 1;
	};

	x := x + dx;
	y := y + dy;
}

export update() -> () {
	handleInput();

	store<>(DRAW_COLORS, 2);
	text(0x25a0, 24, 50);

	store<>(DRAW_COLORS, 3);
	blit(0xa0b0, x, y, 8, 8, 0)
}